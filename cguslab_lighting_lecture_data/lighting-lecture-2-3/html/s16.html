<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>AI와 함께 USD 코드 생성하기</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism-tomorrow.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            overflow-x: hidden;
        }
        .slide-container {
            width: 1280px;
            min-height: 720px;
            margin: 0 auto;
            position: relative;
        }
        .title-accent {
            color: #60a5fa;
        }
        .number-badge {
            background-color: #a855f7;
        }
        #gemini-result-container pre {
            background: #1e293b;
            padding: 1.25em;
            border-radius: 0.5rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
            min-height: 250px;
        }
        code[class*="language-"] {
            font-family: 'D2Coding', 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-break: break-all;
        }
        #gemini-button {
            transition: background-color 0.3s;
        }
        #gemini-button:disabled {
            background-color: #4b5563;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
<div class="slide-container relative bg-slate-900">
    <!-- Main Content -->
    <div class="relative z-10 px-12 py-10 w-full max-w-5xl mx-auto">
        <!-- Header Section -->
        <div class="mb-5">
            <div class="flex items-center mb-3">
                <div class="number-badge rounded-full w-10 h-10 flex items-center justify-center text-white font-bold text-lg mr-4">
                    4.4
                </div>
                <h1 class="text-4xl font-black">AI와 함께 <span class="title-accent">USD 코드 생성하기</span></h1>
            </div>
            <p class="text-gray-400 text-lg ml-14">만들고 싶은 것을 간단히 설명해보세요. AI가 .usda 코드를 생성해줍니다.</p>
        </div>
        
        <!-- Main Content -->
        <div class="mt-4">
            <div class="flex gap-2">
                <input type="text" id="gemini-prompt" class="w-full bg-slate-700 border border-slate-600 rounded-md p-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="예: 바닥에 놓인 빨간색 구와 파란색 큐브, 그리고 노란색 조명">
                <button id="gemini-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-md whitespace-nowrap flex items-center">
                    <i class="fas fa-magic mr-2"></i>코드 생성
                </button>
            </div>
            <div id="gemini-result-container" class="mt-4">
                 <pre id="gemini-result"><code class="language-usd"># AI가 생성한 코드가 여기에 표시됩니다.</code></pre>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <div class="absolute bottom-6 left-12 right-12 flex justify-between items-center text-gray-400">
        <div class="flex items-center">
            <i class="fas fa-university mr-2"></i>
            <span class="text-sm">Computer Graphics & Data Management Course</span>
        </div>
        <div class="flex items-center space-x-4">
            <span class="text-sm">Slide 11 of 12</span>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/components/prism-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/plugins/autoloader/prism-autoloader.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const geminiButton = document.getElementById('gemini-button');
        const geminiPromptInput = document.getElementById('gemini-prompt');
        const geminiResultPre = document.getElementById('gemini-result');

        geminiButton.addEventListener('click', callGemini);
        geminiPromptInput.addEventListener('keyup', (e) => {
            if(e.key === 'Enter') {
                callGemini();
            }
        });

        async function callGemini() {
            const userPrompt = geminiPromptInput.value;
            if (!userPrompt) {
                geminiResultPre.innerHTML = `<code class="language-usd"># 생성할 내용을 입력해주세요.</code>`;
                return;
            }

            geminiButton.disabled = true;
            geminiButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>생성 중...';
            geminiResultPre.innerHTML = `<code class="language-usd"># AI가 코드를 생성하는 중입니다...</code>`;

            const fullPrompt = `You are an expert in Pixar's USD. Based on the following user request, generate a simple and clean .usda code snippet.
            - The user request is in Korean, but generate standard USD code.
            - Only provide the raw .usda code itself, without any explanation or markdown formatting like \`\`\`usd or \`\`\`.
            - For colors, use the 'color3f[] primvars:displayColor' attribute for geometry. For lights, use the 'color' attribute. For example, for a red sphere: def Sphere "red_sphere" { color3f[] primvars:displayColor = [(1, 0, 0)] }. For a yellow light: def SphereLight "yellow_light" { color3f color = (1, 1, 0) }.
            - Keep it simple and focused on the request. Create a root Xform named "World".

            User Request: "${userPrompt}"`;
            
            // IMPORTANT: Replace with your actual Gemini API Key
            const apiKey = "YOUR_GEMINI_API_KEY"; 
            
            if (apiKey === "YOUR_GEMINI_API_KEY") {
                 geminiResultPre.innerHTML = `<code class="language-usd"># 에러: Gemini API 키가 코드에 설정되지 않았습니다.\n# s16.html 파일의 스크립트에서 YOUR_GEMINI_API_KEY를 실제 키로 교체해주세요.</code>`;
                 geminiButton.disabled = false;
                 geminiButton.innerHTML = '<i class="fas fa-magic mr-2"></i>코드 생성';
                 return;
            }

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`;
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: fullPrompt }] }] })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error ? error.error.message : `API error: ${response.statusText}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    geminiResultPre.innerHTML = `<code class="language-usd">${escapeHtml(text)}</code>`;
                } else {
                    throw new Error("Invalid response structure from API.");
                }

            } catch (error) {
                console.error('Error calling Gemini API:', error);
                geminiResultPre.innerHTML = `<code class="language-usd"># 코드 생성에 실패했습니다. 다시 시도해주세요. \n# Error: ${error.message}</code>`;
            } finally {
                geminiButton.disabled = false;
                geminiButton.innerHTML = '<i class="fas fa-magic mr-2"></i>코드 생성';
            }
        }
        
        function escapeHtml(unsafe) {
            return unsafe
                 .replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;")
                 .replace(/"/g, "&quot;")
                 .replace(/'/g, "&#039;");
        }
    });
</script>
</body>
</html> 